_format_version: "1.1"

services:
- name: argonaut-service
  url: {{data-query-endpoint}}
  routes:
  - name: argonaut-informational-routes
    paths:
    - /
  - name: argonaut-authorize-route
    paths:
    - /authorize
    strip_path: false
    plugins:
    - name: request-termination
      config:
        status_code: 307
    - name: response-transformer
      config:
        add:
          headers:
            - 'Location: {{authorize-endpoint}}'
  - name: argonaut-token-route
    paths:
    - /token
    strip_path: false
    plugins:
    - name: health-apis-static-token-handler
      config:
        static_refresh_token: {{static-refresh-token}}
        static_access_token: {{static-access-token}}
        static_expiration: 3599
        static_icn: {{static-icn}}
        static_scopes: {{static-scopes}}
    - name: health-apis-patient-registration
      config:
        ids_url: {{ids-endpoint}}/api/v1/ids
        token_url: 'Location: {{token-endpoint}}'
        token_timeout: 10000
        static_refresh_token: {{static-refresh-token}}
        static_icn: {{static-icn}}
  - name: argonaut-base-api-route
    paths:
    - /api
    strip_path: false
    plugins:
    - name: health-apis-token-validator
      config:
        verification_url: {{validation_endpoint}}
        verification_timeout: 10000
        api_key: {{api-key}}
        static_token: {{static-access-token}}
        static_icn: {{static-icn}}
  - name: argonaut-metadata-route
    paths: 
    - /api/metadata
    strip_path: false